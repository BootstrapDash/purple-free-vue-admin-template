/*!
 * vue-dragula v2.5.3
 * (c) 2018 Yichang Liu
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.vueDragula=e.vueDragula||{})}(this,function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}function o(e){J(function(){J(e)})}function i(e){window.setTimeout(e,50)}function r(e){return e===Object(e)}function a(e){var t=e.ctx,n=e.name,o=e.drake;return new W({ctx:t,name:n,drake:o})}function s(e){return new G(e)}function l(e){return!e||0===e.length}function u(e){function t(){var e;if(s.logging&&s.logging.plugin){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];(e=console).log.apply(e,["vue-dragula plugin"].concat(n))}}function n(){var e;if(s.logging&&s.logging.service){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];(e=console).log.apply(e,["vue-dragula service config: "].concat(n))}}function o(){var e;if(s.logging&&s.logging.directive){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];(e=console).log.apply(e,["v-dragula directive"].concat(n))}}function i(e,t,n){if(t){var i=t.context.$dragula;if(i){o("trying to find and use component service");var r=i.service(n);if(r)return o("using component service",r),r}}return o("using global service",h),h}function r(e,t,n){var o=t?t.data.attrs.drake:this.params.drake,i=t?t.data.attrs.service:this.params.service;return void 0!==o&&0!==o.length&&(e=o),o=l(o)?"default":o,{name:e,drakeName:o,serviceName:i}}function a(e,t,n,a){o("updateDirective");var s=n?t.value:e;if(s){var l=r(v,n,this),u=l.name,d=l.drakeName,c=l.serviceName,h=i(u,n,c),f=h.find(d,n);g[d]=g[d]||[];var m=g[d];if(m){if(m.find(function(t){return t===e}))return void o("already has drake container configured",d,e)}if(!h)return void o("no service found",u,d);f.models||(f.models=[]),n||(e=this.el);var p=h.findModelContainerByContainer(e,f);m.push(e),o("DATA",{service:{name:c,instance:h},drake:{name:d,instance:f},container:e,modelContainer:p}),p?(o("set model of container",s),p.model=s):(o("push model and container on drake",s,e),f.models.push({model:s,container:e}))}}var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!0===s.logging&&(s.logging={plugin:!0,directive:!0,service:!0,dragHandler:!0}),t("Initializing vue-dragula plugin",s);var u=s.createService||Z.createService,d=s.createEventBus||Z.createEventBus||new e;t("create eventBus",d);var c=d(e,s);if(!c)throw console.warn("Eventbus could not be created"),new Error("Eventbus could not be created");t("eventBus created",c);var h=u({name:"global.dragula",eventBus:c,drakes:s.drakes,options:s}),v="globalDrake",f=function(){function e(t){$(this,e),this.options=t,this.$service={options:h.setOptions.bind(h),find:h.find.bind(h),eventBus:h.eventBus},this.$service.options("default",{}),this.createServices=this.createService}return U(e,[{key:"optionsFor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.service(e).setOptions(t),this}},{key:"createService",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("createService",t),this._serviceMap=this._serviceMap||{};var o=t.names||[],i=t.name||[],r=t.drakes||{},a=t.drake,l=Object.assign({},s,t);o=o.length>0?o:[i];var d=t.eventBus||h.eventBus;return d||console.warn("Eventbus could not be created",d),n("names",o),o.forEach(function(t){var o={name:t,eventBus:d,options:l};n("create DragulaService",t,o),e._serviceMap[t]=u(o),r.default||(r.default=a||!0),e.drakesFor(t,r)}),this}},{key:"drakesFor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n("drakesFor",e,t);var o=this.service(e);return Array.isArray(t)&&(t=t.reduce(function(e,t){return e[t]=!0,e},{})),Object.keys(t).forEach(function(e){var n=t[e];!0===n&&(n={}),o.setOptions(e,n)}),this}},{key:"on",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n("on",e,o),"object"===(void 0===e?"undefined":_typeof(e))){o=e;var i=this.serviceNames;return!i||i.length<1?(console.warn("vue-dragula: No services found to add events handlers for",this._serviceMap),this):(n("add event handlers for",i),i.forEach(function(e){t.on(e,o)}),this)}var r=this.service(e);return r?(n("service.on",r,o),r.on(o),this):(console.warn("vue-dragula: no service "+e+" to add event handlers for"),this)}},{key:"service",value:function(e){if(this._serviceMap){var t=this._serviceMap[e];if(n("lookup service",e,t),!t){n("not found by name, get default");var o=this.serviceNames;o&&(t=this._serviceMap[o[0]])}return t}}},{key:"serviceNames",get:function(){return Object.keys(this._serviceMap)}},{key:"services",get:function(){return Object.values(this._serviceMap)}}]),e}();e.$dragula=new f(s);var g={};e.prototype.$dragula=e.$dragula,e.directive("dragula",{params:["drake","service"],bind:function(e,t,n){o("BIND",e,t,n);var a=r(v,n,this),s=a.name,l=a.drakeName,u=a.serviceName,d=i(s,n,u),c=d.find(l,n);if(n||(e=this.el),o({service:{name:u,instance:d},drake:{name:l,instance:c},container:e}),c)return void c.containers.push(e);var h=H({containers:[e]});d.add(s,h),d.handleModels(s,h)},update:function(t,n,i,r){o("UPDATE",t,n,i),1===e.version&&a(t,n,i,r)},componentUpdated:function(e,t,n,i){o("COMPONENT UPDATED",e,t,n)},inserted:function(e,t,n,i){o("INSERTED",e,t,n),a(e,t,n,i)},unbind:function(e,t,n){o("UNBIND",e,t,n);var a=r(v,n,this),s=a.name,l=a.drakeName,u=a.serviceName,d=i(s,n,u),c=d.find(l,n);if(o({service:{name:u,instance:d},drake:{name:l,instance:c},container:e}),c){var h=c.containers.indexOf(e);h>-1&&(o("remove container",h),c.containers.splice(h,1)),0===c.containers.length&&(o("destroy service"),d.destroy(s))}}})}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.installed&&console.warn("[vue-dragula] already installed."),console.log("Add Dragula plugin:",t),u(e,t)}var c="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},h=n(function(e){e.exports=function(e,t){return Array.prototype.slice.call(e,t)}}),v=t(h),f=Object.freeze({default:v}),g=n(function(e){var t,n="function"==typeof setImmediate;t=n?function(e){setImmediate(e)}:"undefined"!=typeof process&&process.nextTick?process.nextTick:function(e){setTimeout(e,0)},e.exports=t}),m=t(g),p=Object.freeze({default:m}),y=n(function(e){var n=t(p);e.exports=function(e,t,o){e&&n(function(){e.apply(o||null,t||[])})}}),k=t(y),M=Object.freeze({default:k}),b=n(function(e){var n=t(f),o=t(M);e.exports=function(e,t){var i=t||{},r={};return void 0===e&&(e={}),e.on=function(t,n){return r[t]?r[t].push(n):r[t]=[n],e},e.once=function(t,n){return n._once=!0,e.on(t,n),e},e.off=function(t,n){var o=arguments.length;if(1===o)delete r[t];else if(0===o)r={};else{var i=r[t];if(!i)return e;i.splice(i.indexOf(n),1)}return e},e.emit=function(){var t=n(arguments);return e.emitterSnapshot(t.shift()).apply(this,t)},e.emitterSnapshot=function(t){var a=(r[t]||[]).slice(0);return function(){var r=n(arguments),s=this||e;if("error"===t&&!1!==i.throws&&!a.length)throw 1===r.length?r[0]:r;return a.forEach(function(n){i.async?o(n,r,s):n.apply(s,r),n._once&&e.off(t,n)}),e}},e}}),x=t(b),E=Object.freeze({default:x}),I=n(function(e){var t=c.CustomEvent;e.exports=function(){try{var e=new t("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?t:"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n}}),w=t(I),O=Object.freeze({default:w}),A=n(function(e){var t=[],n="",o=/^on/;for(n in c)o.test(n)&&t.push(n.slice(2));e.exports=t}),N=t(A),C=Object.freeze({default:N}),T=n(function(e){function n(e,t,n,o){return e.addEventListener(t,n,o)}function o(e,t,n){return e.attachEvent("on"+t,l(e,t,n))}function i(e,t,n,o){return e.removeEventListener(t,n,o)}function r(e,t,n){var o=u(e,t,n);if(o)return e.detachEvent("on"+t,o)}function a(e,t,n){var o=-1===v.indexOf(t)?function(){return new h(t,{detail:n})}():function(){var e;return f.createEvent?(e=f.createEvent("Event"),e.initEvent(t,!0,!0)):f.createEventObject&&(e=f.createEventObject()),e}();e.dispatchEvent?e.dispatchEvent(o):e.fireEvent("on"+t,o)}function s(e,t,n){return function(t){var o=t||c.event;o.target=o.target||o.srcElement,o.preventDefault=o.preventDefault||function(){o.returnValue=!1},o.stopPropagation=o.stopPropagation||function(){o.cancelBubble=!0},o.which=o.which||o.keyCode,n.call(e,o)}}function l(e,t,n){var o=u(e,t,n)||s(e,t,n);return p.push({wrapper:o,element:e,type:t,fn:n}),o}function u(e,t,n){var o=d(e,t,n);if(o){var i=p[o].wrapper;return p.splice(o,1),i}}function d(e,t,n){var o,i;for(o=0;o<p.length;o++)if(i=p[o],i.element===e&&i.type===t&&i.fn===n)return o}var h=t(O),v=t(C),f=c.document,g=n,m=i,p=[];c.addEventListener||(g=o,m=r),e.exports={add:g,remove:m,fabricate:a}}),S=t(T),_=T.add,B=T.remove,D=T.fabricate,j=Object.freeze({default:S,add:_,remove:B,fabricate:D}),z=n(function(e){function t(e){var t=i[e];return t?t.lastIndex=0:i[e]=t=new RegExp(r+e+a,"g"),t}function n(e,n){var o=e.className;o.length?t(n).test(o)||(e.className+=" "+n):e.className=n}function o(e,n){e.className=e.className.replace(t(n)," ").trim()}var i={},r="(?:^|\\s)",a="(?:\\s|$)";e.exports={add:n,rm:o}}),R=t(z),Y=z.add,F=z.rm,P=Object.freeze({default:R,add:Y,rm:F}),L=n(function(e){function n(e,t){function n(e){return-1!==ue.containers.indexOf(e)||le.isContainer(e)}function a(e){var t=e?"remove":"add";o(I,t,"mousedown",w),o(I,t,"mouseup",D)}function c(e){o(I,e?"remove":"add","mousemove",O)}function g(e){var t=e?"remove":"add";M[t](I,"selectstart",E),M[t](I,"click",E)}function p(){a(!0),D({})}function E(e){ae&&e.preventDefault()}function w(e){if(ee=e.clientX,te=e.clientY,!(1!==i(e)||e.metaKey||e.ctrlKey)){var t=e.target,n=A(t);n&&(ae=n,c(),"mousedown"===e.type&&(f(t)?t.focus():e.preventDefault()))}}function O(e){if(ae){if(0===i(e))return void D({});if(void 0===e.clientX||e.clientX!==ee||void 0===e.clientY||e.clientY!==te){if(le.ignoreInputTextSelection){var t=y("clientX",e),n=y("clientY",e);if(f(x.elementFromPoint(t,n)))return}var o=ae;c(!0),g(),_(),T(o);var a=r(G);Q=y("pageX",e)-a.left,Z=y("pageY",e)-a.top,b.add(ie||G,"gu-transit"),U(),L(e)}}}function A(e){if(!(ue.dragging&&W||n(e))){for(var t=e;v(e)&&!1===n(v(e));){if(le.invalid(e,t))return;if(!(e=v(e)))return}var o=v(e);if(o&&!le.invalid(e,t)){if(le.moves(e,o,t,m(e)))return{item:e,source:o}}}}function N(e){return!!A(e)}function C(e){var t=A(e);t&&T(t)}function T(e){K(e.item,e.source)&&(ie=e.item.cloneNode(!0),ue.emit("cloned",ie,e.item,"copy")),q=e.source,G=e.item,ne=oe=m(e.item),ue.dragging=!0,ue.emit("drag",G,q)}function S(){return!1}function _(){if(ue.dragging){var e=ie||G;j(e,v(e))}}function B(){ae=!1,c(!0),g(!0)}function D(e){if(B(),ue.dragging){var t=ie||G,n=y("clientX",e),o=y("clientY",e),i=s(W,n,o),r=P(i,n,o);r&&(ie&&le.copySortSource||!ie||r!==q)?j(t,r):le.removeOnSpill?z():R()}}function j(e,t){var n=v(e);ie&&le.copySortSource&&t===q&&n.removeChild(G),F(t)?ue.emit("cancel",e,q,q):ue.emit("drop",e,t,q,oe),Y()}function z(){if(ue.dragging){var e=ie||G,t=v(e);t&&t.removeChild(e),ue.emit(ie?"cancel":"remove",e,t,q),Y()}}function R(e){if(ue.dragging){var t=arguments.length>0?e:le.revertOnSpill,n=ie||G,o=v(n),i=F(o);!1===i&&t&&(ie?o&&o.removeChild(ie):q.insertBefore(n,ne)),i||t?ue.emit("cancel",n,q,q):ue.emit("drop",n,o,q,oe),Y()}}function Y(){var e=ie||G;B(),X(),e&&b.rm(e,"gu-transit"),re&&clearTimeout(re),ue.dragging=!1,se&&ue.emit("out",e,se,q),ue.emit("dragend",e),q=G=ie=ne=oe=re=se=null}function F(e,t){var n;return n=void 0!==t?t:W?oe:m(ie||G),e===q&&n===ne}function P(e,t,o){for(var i=e;i&&!function(){if(!1===n(i))return!1;var r=V(i,e),a=J(i,r,t,o);return!!F(i,a)||le.accepts(G,i,q,a)}();)i=v(i);return i}function L(e){function t(e){ue.emit(e,a,se,q)}if(W){e.preventDefault();var n=y("clientX",e),o=y("clientY",e),i=n-Q,r=o-Z;W.style.left=i+"px",W.style.top=r+"px";var a=ie||G,l=s(W,n,o),u=P(l,n,o),d=null!==u&&u!==se;(d||null===u)&&(function(){se&&t("out")}(),se=u,function(){d&&t("over")}());var c=v(a);if(u===q&&ie&&!le.copySortSource)return void(c&&c.removeChild(a));var h,f=V(u,l);if(null!==f)h=J(u,f,n,o);else{if(!0!==le.revertOnSpill||ie)return void(ie&&c&&c.removeChild(a));h=ne,u=q}(null===h&&d||h!==a&&h!==m(a))&&(oe=h,u.insertBefore(a,h),ue.emit("shadow",a,u,q))}}function H(e){b.rm(e,"gu-hide")}function $(e){ue.dragging&&b.add(e,"gu-hide")}function U(){if(!W){var e=G.getBoundingClientRect();W=G.cloneNode(!0),W.style.width=d(e)+"px",W.style.height=h(e)+"px",b.rm(W,"gu-transit"),b.add(W,"gu-mirror"),le.mirrorContainer.appendChild(W),o(I,"add","mousemove",L),b.add(le.mirrorContainer,"gu-unselectable"),ue.emit("cloned",W,G,"mirror")}}function X(){W&&(b.rm(le.mirrorContainer,"gu-unselectable"),o(I,"remove","mousemove",L),v(W).removeChild(W),W=null)}function V(e,t){for(var n=t;n!==e&&v(n)!==e;)n=v(n);return n===I?null:n}function J(e,t,n,o){function i(e){return e?m(t):t}var r="horizontal"===le.direction;return t!==e?function(){var e=t.getBoundingClientRect();return i(r?n>e.left+d(e)/2:o>e.top+h(e)/2)}():function(){var t,i,a,s=e.children.length;for(t=0;t<s;t++){if(i=e.children[t],a=i.getBoundingClientRect(),r&&a.left+a.width/2>n)return i;if(!r&&a.top+a.height/2>o)return i}return null}()}function K(e,t){return"boolean"==typeof le.copy?le.copy:le.copy(e,t)}1===arguments.length&&!1===Array.isArray(e)&&(t=e,e=[]);var W,q,G,Q,Z,ee,te,ne,oe,ie,re,ae,se=null,le=t||{};void 0===le.moves&&(le.moves=u),void 0===le.accepts&&(le.accepts=u),void 0===le.invalid&&(le.invalid=S),void 0===le.containers&&(le.containers=e||[]),void 0===le.isContainer&&(le.isContainer=l),void 0===le.copy&&(le.copy=!1),void 0===le.copySortSource&&(le.copySortSource=!1),void 0===le.revertOnSpill&&(le.revertOnSpill=!1),void 0===le.removeOnSpill&&(le.removeOnSpill=!1),void 0===le.direction&&(le.direction="vertical"),void 0===le.ignoreInputTextSelection&&(le.ignoreInputTextSelection=!0),void 0===le.mirrorContainer&&(le.mirrorContainer=x.body);var ue=k({containers:le.containers,start:C,end:_,cancel:R,remove:z,destroy:p,canMove:N,dragging:!1});return!0===le.removeOnSpill&&ue.on("over",H).on("out",$),a(),ue}function o(e,t,n,o){var i={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},r={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},a={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};c.navigator.pointerEnabled?M[t](e,r[n],o):c.navigator.msPointerEnabled?M[t](e,a[n],o):(M[t](e,i[n],o),M[t](e,n,o))}function i(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var t=e.button;return void 0!==t?1&t?1:2&t?3:4&t?2:0:void 0}function r(e){var t=e.getBoundingClientRect();return{left:t.left+a("scrollLeft","pageXOffset"),top:t.top+a("scrollTop","pageYOffset")}}function a(e,t){return void 0!==c[t]?c[t]:I.clientHeight?I[e]:x.body[e]}function s(e,t,n){var o,i=e||{},r=i.className;return i.className+=" gu-hide",o=x.elementFromPoint(t,n),i.className=r,o}function l(){return!1}function u(){return!0}function d(e){return e.width||e.right-e.left}function h(e){return e.height||e.bottom-e.top}function v(e){return e.parentNode===x?null:e.parentNode}function f(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||g(e)}function g(e){return!!e&&("false"!==e.contentEditable&&("true"===e.contentEditable||g(v(e))))}function m(e){return e.nextElementSibling||function(){var t=e;do{t=t.nextSibling}while(t&&1!==t.nodeType);return t}()}function p(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}function y(e,t){var n=p(t),o={pageX:"clientX",pageY:"clientY"};return e in o&&!(e in n)&&o[e]in n&&(e=o[e]),n[e]}var k=t(E),M=t(j),b=t(P),x=document,I=x.documentElement;e.exports=n}),H=t(L),$=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},U=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),X=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},V=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},J=window.requestAnimationFrame,K=J?o:i,W=function(){function e(t){var n=t.ctx,o=t.name,i=t.drake;t.options;$(this,e),this.dragElm=null,this.dragIndex=null,this.dropIndex=null,this.sourceModel=null,this.logging=n.logging,this.ctx=n,this.serviceName=n.name,this.modelManager=n.modelManager,this.drake=i,this.name=o,this.eventBus=n.eventBus,this.findModelForContainer=n.findModelForContainer.bind(n),this.domIndexOf=n.domIndexOf.bind(n)}return U(e,[{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(o))}}},{key:"removeModel",value:function(){this.log("removeModel",{sourceModel:this.sourceModel,dragIndex:this.dragIndex}),this.sourceModel.removeAt(this.dragIndex)}},{key:"dropModelSame",value:function(){this.log("dropModelSame",{sourceModel:this.sourceModel,dragIndex:this.dragIndex,dropIndex:this.dropIndex}),this.sourceModel.move({dropIndex:this.dropIndex,dragIndex:this.dragIndex})}},{key:"insertModel",value:function(e,t,n){this.log("insertModel",{targetModel:e,dropIndex:this.dropIndex,dropElmModel:t,elements:n}),e.insertAt(this.dropIndex,t),this.emit("insertAt",{elements:n,targetModel:e,transitModel:t,dragIndex:this.dragIndex,dropIndex:this.dropIndex,models:{source:this.sourceModel,target:e,transit:t},indexes:{source:this.dragIndex,target:this.dropIndex}})}},{key:"notCopy",value:function(){var e=this;K(function(){e.sourceModel.removeAt(e.dragIndex)})}},{key:"cancelDrop",value:function(e){this.log("No targetModel could be found for target:",{target:e}),this.log("in drake:",{drake:this.drake}),this.drake.cancel(!0)}},{key:"dropModelTarget",value:function(e,t,n){this.log("dropModelTarget",{dropElm:e,target:t,source:n});var o=this.dragElm===e,i=this.getModel(t),r=o?this.dropElmModel():this.jsonDropElmModel();if(o&&this.notCopy(),!i)return this.cancelDrop(t);var a={drop:e,target:t,source:n};this.insertModel(i,r,a)}},{key:"dropModel",value:function(e,t,n){this.log("dropModel",{dropElm:e,target:t,source:n}),t===n?this.dropModelSame():this.dropModelTarget(e,t,n)}},{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("emit",{eventName:e,opts:t}),t.sourceModel=this.sourceModel,t.name=this.name,this.eventBus.$emit(e,t),this.log("emit service",{serviceEventName:n,eventName:e,opts:t});var n=this.serviceName+":"+e;this.eventBus.$emit(n,t)}},{key:"getModel",value:function(e){var t=this.findModelForContainer(e,this.drake);return this.log("getModel",{location:e,model:t}),this.modelManager.createFor({name:this.name,drake:this.drake,logging:this.logging,model:t})}},{key:"remove",value:function(e,t,n){if(this.log("remove",{el:e,container:t,source:n}),!this.drake.models)return void this.log("Warning: Can NOT remove it. Must have models:",this.drake.models);this.sourceModel=this.getModel(n),this.removeModel(),this.drake.cancel(!0),this.emit("removeModel",{el:e,source:n,dragIndex:this.dragIndex})}},{key:"drag",value:function(e,t){this.log("drag",{el:e,source:t}),this.dragElm=e,this.dragIndex=this.domIndexOf(e,t)}},{key:"drop",value:function(e,t,n){if(this.log("drop",{dropEl:e,target:t,source:n}),!this.drake.models&&!t)return void this.log("Warning: Can NOT drop it. Must have either models:",this.drake.models," or target:",t);this.dropIndex=this.domIndexOf(e,t),this.sourceModel=this.getModel(n),this.dropModel(e,t,n),this.emit("dropModel",{target:t,source:n,el:e,dragIndex:this.dragIndex,dropIndex:this.dropIndex})}},{key:"dropElmModel",value:function(){return this.sourceModel.at(this.dragIndex)}},{key:"jsonDropElmModel",value:function(){var e=this.sourceModel.at(this.dragIndex),t=e?e.model||e.stringable:e;r(t||e)||this.log("jsonDropElmModel","invalid element model, must be some sort of Object",t,e);try{var n=JSON.stringify(t||e);return JSON.parse(n)}catch(e){this.log("jsonDropElmModel","JSON stringify/parse error",e)}}},{key:"clazzName",get:function(){return this.constructor.name||"DragHandler"}},{key:"shouldLog",get:function(){return this.logging&&this.logging.dragHandler}}]),e}(),q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$(this,e),Array.isArray(t)&&(t={model:t}),t.drake=t.drake||{},this.opts=t,this.copy=t.copy||t.drake.copy,this.name=t.name,this.drake=t.drake,this.logging=t.logging,this.logging=t.logging,this.modelRef=t.model||[]}return U(e,[{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(o))}}},{key:"notYet",value:function(e){this.log(e,"not yet implemented")}},{key:"undo",value:function(){this.notYet("undo")}},{key:"redo",value:function(){this.notYet("redo")}},{key:"at",value:function(e){this.notYet("at")}},{key:"clear",value:function(){this.notYet("clear")}},{key:"createModel",value:function(e){this.notYet("createModel")}},{key:"createFor",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.notYet("createFor")}},{key:"removeAt",value:function(e){this.notYet("removeAt")}},{key:"insertAt",value:function(e,t){this.notYet("removeAt")}},{key:"move",value:function(e){e.dragIndex,e.dropIndex;this.notYet("move")}},{key:"clazzName",get:function(){return this.constructor.name||"BaseModelManager"}},{key:"shouldLog",get:function(){return this.logging&&this.logging.modelManager}}]),e}(),G=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$(this,t);var n=V(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.model=n.createModel(n.modelRef),n.log("CREATE",e),n}return X(t,e),U(t,[{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(o))}}},{key:"undo",value:function(){this.log("undo","not yet implemented")}},{key:"redo",value:function(){this.log("redo","not yet implemented")}},{key:"at",value:function(e){return this.model.get?this.model.get(e):this.model[e]}},{key:"clear",value:function(){this.model=this.createModel()}},{key:"createModel",value:function(e){return this.model||e||[]}},{key:"createFor",value:function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"removeAt",value:function(e){if(!this.copy){this.log("removeAt",{model:this.model,index:e});var t=this.model.splice(e,1),n=this.model;return this.log({splicedModel:t,removedModel:n}),t}}},{key:"insertAt",value:function(e,t){this.log("insertAt",{model:this.model,index:e,insertModel:t});var n=this.model.splice(e,0,t),o=this.model;return this.log("insertAt",{splicedModel:n,modelAfterInsert:o}),o}},{key:"move",value:function(e){var t=e.dragIndex,n=e.dropIndex;if(!this.copy){this.log("move",{model:this.model,dragIndex:t,dropIndex:n});var o=this.model.splice(t,1),i=o[0],r=this.model.splice(n,0,i),a=this.model;return this.log("move",{splicedRemainder:o,modelAfterRemove:r,movedModel:a}),r}}},{key:"clazzName",get:function(){return this.constructor.name||"ModelManager"}},{key:"shouldLog",get:function(){return this.logging&&this.logging.modelManager}}]),t}(q);if(!H)throw new Error("[vue-dragula] cannot locate dragula.");var Q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$(this,e);var n=t.name,o=t.eventBus,i=t.drakes,r=t.options;r=r||{},this.options=r,this.logging=r.logging,this.log("CREATE DragulaService",t),this.name=n,this.drakes=i||{},this.eventBus=o,this.createDragHandler=r.createDragHandler||a,this.createModelManager=r.createModelManager||s,this.modelManager=this.createModelManager(r),this.events=["cancel","cloned","drag","dragend","drop","out","over","remove","shadow","dropModel","removeModel","accepts","moves","invalid"]}return U(e,[{key:"addEvents",value:function(){var e;this.events=(e=this.events).concat.apply(e,arguments)}},{key:"removeEvents",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.events=this.events.filter(function(e){return t.includes(e)})}},{key:"createModel",value:function(){return this.modelManager.createModel()}},{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];(t=console).log.apply(t,["DragulaService ["+this.name+"] :",e].concat(o))}}},{key:"error",value:function(e){throw console.error(e),new Error(e)}},{key:"_validate",value:function(e,t){t||this.error(e+" must take a drake name as the first argument")}},{key:"add",value:function(e,t){if(this.log("add (drake)",e,t),this._validate("add",e),this.find(e)){this.log("existing drakes",this.drakeNames);var n='Drake named: "'+e+'" already exists for this service ['+this.name+"].\n      Most likely this error in cause by a race condition evaluating multiple template elements with\n      the v-dragula directive having the same drake name. Please initialise the drake in the created() life cycle hook of the VM to fix this problem.";this.error(n)}return this.drakes[e]=t,t.models&&this.handleModels(e,t),t.initEvents||this.setupEvents(e,t),t}},{key:"find",value:function(e){return this.log("find (drake) by name",e),this._validate("find",e),this.drakes[e]}},{key:"handleModels",value:function(e,t){if(this.log("handleModels",e,t),this._validate("handleModels",e),t.registered)return void this.log("handleModels","already registered");var n=this.createDragHandler({ctx:this,name:e,drake:t});this.log("created dragHandler for service",n),t.on("remove",n.remove.bind(n)),t.on("drag",n.drag.bind(n)),t.on("drop",n.drop.bind(n)),t.registered=!0}},{key:"on",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.log("on (events) ",t),Object.keys(t).forEach(function(n){var o=t[n];e.log("$on",n,o),e.eventBus.$on(n,o)})}},{key:"destroy",value:function(e){this.log("destroy (drake) ",e),this._validate("destroy",e);var t=this.find(e);t&&(t.destroy(),this._delete(e))}},{key:"_delete",value:function(e){delete this.drakes[e]}},{key:"setOptions",value:function(e,t){this.log("setOptions (drake)",e,t),this._validate("setOptions",e);var n=this.add(e,H(t));return this.handleModels(e,n),this}},{key:"calcOpts",value:function(e,t){function n(){return{}}return(this.argsEventMap[e]||this.argsEventMap.defaultEvent||n)(t)}},{key:"setupEvents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("setupEvents",e,t),this._validate("setupEvents",e),t.initEvents=!0;var n=this,o=function(o){function i(){var i=Array.prototype.slice.call(arguments),r=n.calcOpts(e,i);r.name=e,r.service=this,r.drake=t,n.log("eventBus.$emit",o,e,r),n.eventBus.$emit(o,r),n.eventBus.$emit(this.name+":"+o,r)}n.log("emitter",o),t.on(o,i)};this.events.forEach(o)}},{key:"domIndexOf",value:function(e,t){return Array.prototype.indexOf.call(t.children,e)}},{key:"findModelForContainer",value:function(e,t){return this.log("findModelForContainer",e,t),(this.findModelContainerByContainer(e,t)||{}).model}},{key:"findModelContainerByContainer",value:function(e,t){if(!t.models)return void this.log("findModelContainerByContainer","warning: no models found");var n=t.models.find(function(t){return t.container===e});return n||(this.log("No matching model could be found for container:",e),this.log("in drake",t.name," models:",t.models)),n}},{key:"shouldLog",get:function(){return this.logging&&this.logging.service}},{key:"drakeNames",get:function(){return Object.keys(this.drakes)}},{key:"argsEventMap",get:function(){return this._argsEventMap=this._argsEventMap||this.defaultArgsEventMap,this._argsEventMap},set:function(e){this._argsEventMap=e}},{key:"defaultArgsEventMap",get:function(){return{cloned:function(e){return{clone:e[0],original:e[1],type:e[2]}},moves:function(e){return{el:e[0],source:e[1],handle:e[2],sibling:e[3]}},copy:function(e){return{el:e[0],source:e[1]}},accepts:function(e){return{el:e[0],target:e[1],source:e[2],sibling:e[3]}},invalid:function(e){return{el:e[0],handle:e[1]}},drag:function(e){return{el:e[0],source:e[1]}},dragend:function(e){return{el:e[0]}},drop:function(e){return{el:e[0],target:e[1],source:e[2],sibling:e[3]}},defaultEvent:function(e){return{el:e[0],container:e[1],source:e[2]}}}}}]),e}();if(!H)throw new Error("[vue-dragula] cannot locate dragula.");var Z={createService:function(e){var t=e.name,n=e.eventBus,o=e.drakes,i=e.options;return new Q({name:t,eventBus:n,drakes:o,options:i})},createEventBus:function(e){return new e}},ee=function(){function e(t){var n=t.name,o=t.model,i=t.modelRef,r=t.history,a=t.logging;$(this,e),this.name=n||"default",this.model=o,this.modelRef=i,this.logging=a,this.history=r||this.createHistory(),this.history.push(this.model),this.timeIndex=0}return U(e,[{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(o))}}},{key:"createHistory",value:function(){return this.history||[]}},{key:"timeTravel",value:function(e){return this.log("timeTravel to",e),this.model=this.history[e],this.updateModelRef(),this}},{key:"updateModelRef",value:function(){var e=this;this.modelRef.splice(0,this.modelRef.length),this.model.forEach(function(t){e.modelRef.push(t)})}},{key:"undo",value:function(){return this.log("undo timeIndex",this.timeIndex),0!==this.timeIndex&&(this.timeIndex--,this.timeTravel(this.timeIndex),this)}},{key:"redo",value:function(){return this.log("redo timeIndex",this.timeIndex,this.history.length),!(this.timeIndex>this.history.length-1)&&(this.timeIndex++,this.timeTravel(this.timeIndex),this)}},{key:"addToHistory",value:function(e){return this.log("addToHistory"),this.log("old",this.model),this.log("new",e),this.model=e,this.log("model was set to",this.model),this.history.push(e),this.timeIndex++,this.updateModelRef(),this}},{key:"shouldLog",get:function(){return this.logging&&this.logging.modelManager}},{key:"clazzName",get:function(){return this.constructor.name||"TimeMachine"}}]),e}(),te=function(e){return new ee(e)},ne=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$(this,t);var n=V(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.timeOut=e.timeOut||800;var o=e.createTimeMachine||te;return n.timeMachine=o(Object.assign(e,{model:n.model,modelRef:n.modelRef})),n}return X(t,e),U(t,[{key:"timeTravel",value:function(e){return this.timeMachine.timeTravel(e)}},{key:"undo",value:function(){return this.timeMachine.undo(),this}},{key:"redo",value:function(){return this.timeMachine.redo(),this}},{key:"addToHistory",value:function(e){return this.timeMachine.addToHistory(e),this}},{key:"createModel",value:function(e){return e||[]}},{key:"createFor",value:function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"isEmpty",
value:function(){return 0===this.model.length}},{key:"actionUpdateModel",value:function(e){var t=this;setTimeout(function(){t.addToHistory(e)},this.timeOut||800)}},{key:"removeAt",value:function(e){if(!this.copy){this.log("removeAt",{model:this.model,index:e});var t=this.model.slice(0,e),n=this.model.slice(e+1);this.log("removeAt: concat",t,n);var o=this.createModel().concat(t,n);return this.actionUpdateModel(o),o}}},{key:"insertAt",value:function(e,t){this.log("insertAt",{model:this.model,index:e,insertModel:t});var n=this.sliceBefore(e),o=this._sliceAfter(e);this.log("insertAt: concat",{itemsBefore:n,insertModel:t,itemsAfter:o});var i=this._createNewModelFromInsert(n,t,o);return this.log({newModel:i}),this.actionUpdateModel(i),i}},{key:"_createNewModelFromInsert",value:function(e,t,n){return this.createModel().concat(e,t,n)}},{key:"_sliceBefore",value:function(e){return this.model.slice(0,e)}},{key:"_sliceAfter",value:function(e){this.model.slice(e)}},{key:"move",value:function(e){var t=e.dragIndex,n=e.dropIndex;if(!this.copy)return this.log("move",{model:this.model,dragIndex:t,dropIndex:n}),this.timeMachine.undo(),this}},{key:"clazzName",get:function(){return this.constructor.name||"ImmutableModelManager"}},{key:"model",get:function(){return this.timeMachine?this.timeMachine.model:this._model}},{key:"history",get:function(){return this.timeMachine.history}},{key:"timeIndex",get:function(){return this.timeMachine.timeIndex}},{key:"first",get:function(){return this.at(0)}},{key:"last",get:function(){return this.at(this.model.length-1)}}]),t}(G),oe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$(this,e),this.name=t.name||"default",this.logging=t.logging,this.observer={undo:function(e){},redo:function(e){}},this.actions={done:[],undone:[]}}return U(e,[{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(o))}}},{key:"clear",value:function(){this.actions.done=[],this.actions.undone=[]}},{key:"doAct",value:function(e,t){this.log("doAct",{container:e,action:t});var n=e[t].bind(e);if(!n)throw new Error(e,"missing",t,"method");n()}},{key:"isSourceContainerAction",value:function(e){return"copy"!==e}},{key:"isTargetContainerAction",value:function(e){return!0}},{key:"do",value:function(e){var t=e.name,n=e.container,o=n.do,i=n.undo;if(o.length){var r=o.pop(),a=r.models;this.log("do",{name:t,action:r,source:s,target:l});var s=a.source,l=a.target;this.isSourceContainerAction(r)&&this.doAct(s,t),this.isTargetContainerAction(r)&&this.doAct(l,t),this.emitAction(t,r),i.push(r)}}},{key:"emitAction",value:function(e,t){this.log("emitAction",{name:e,action:t});var n=this.observer[e];"function"==typeof n&&n(t)}},{key:"onUndo",value:function(e){this.observer.undo=e}},{key:"onRedo",value:function(e){this.observer.redo=e}},{key:"undo",value:function(){this.log("UNDO"),this.do({name:"undo",container:{do:this.actions.done,undo:this.actions.undone}})}},{key:"redo",value:function(){this.log("REDO"),this.do({name:"redo",container:{do:this.actions.undone,undo:this.actions.done}})}},{key:"act",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=e.models,o=e.indexes,i=e.elements;this.log("act (store action on stack)",{name:t,models:n,indexes:o,elements:i}),this.actions.done.push(e)}},{key:"clazzName",get:function(){return this.constructor.name||"ActionManager"}},{key:"shouldLog",get:function(){return this.logging}}]),e}();d.version="2.0.1";var ie=d;"function"==typeof define&&define.amd?define([],function(){}):window.Vue&&window.Vue.use(d),e.Vue2Dragula=ie,e.DragulaService=Q,e.DragHandler=W,e.ModelManager=G,e.ImmutableModelManager=ne,e.TimeMachine=ee,e.ActionManager=oe});